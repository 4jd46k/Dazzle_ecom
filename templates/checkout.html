<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v3.8.5">
  <title>Dazzle | Checkout</title>
  {% load static %}
  <link rel="icon" type="image/png" href="{% static 'images/logo.png' %}">


  <link href="{% static 'fonts/fontawesome/css/all.min.css' %}" type="text/css" rel="stylesheet">

  <!-- Bootstrap core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
    .custom-border {
      border: 3px solid #C4E1C5 ;
      border-radius: 8px;
    }

      .gif-icon {
        display: inline-block;
        width: 20px; /* Adjust the width and height as needed */
        height: 20px;
        background-image: url('https://img.icons8.com/external-flatart-icons-flat-flatarticons/64/000000/external-clear-cut-covid-19-flatart-icons-flat-flatarticons.png'); /* URL of the provided GIF icon */
        background-size: cover;
        margin-left: 5px; /* Adjust the margin as needed */
      }

  </style>
</head>

<body class="bg-light">
  <!-- Jumbotron -->
  <div class="p-3 text-center bg-white border-bottom shadow">
    <div class="d-flex justify-content-center">
      <div class="col-1 text-center ">
        <a href="{% url 'home' %}" class="brand-wrap">
          <img class="logo img-fluid w-50" src="{% static 'images/logo.png' %}" alt="Logo">
        </a>
      </div>
    </div>
  </div>
  <!-- Jumbotron -->
  </header>
  
  <section class="bg-light py-5">
    <div class="container">
        <div class="row   d-flex justify-content-center">

           {% comment %} ======SECTION 1 ======== {% endcomment %}

          <div class=" col-lg-4 mb-4">
            <div class="card mb-4 custom-border shadow">
              <div class="py-2 ps-4 d-flex justify-content-between">
                <div class="">
                  {% if user.is_authenticated %}
                  <div class="h6 text-body-secondaryry "><span class="badge bg-secondary"> Logged in as</span></div>
                  <div class="h6">{{ user}} - {{ user.email }}</div>
                  {% endif %}
                </div>

              </div>
            </div>
            <!-- Checkout -->
            <div class="custom-border shadow mb-2 p-3 ">
              <div class="d-flex justify-content-between">
                <div class="h6 text-body-secondaryry"><span class="badge bg-secondary">DELIVERY ADDRESS</span></div>
                <button class="btn btn-sm btn-outline-dark fw-semibold" data-bs-toggle ="modal"
                  data-bs-target="#add_address" type="button">Add New</button>
              </div>
              <div class="border my-2 p-2">
                <div class="form-check d-flex justify-content-between">
                  <div id="selectedaddress"></div>
                  <div class="d-flex">
                    <button class="btn btn-outline-dark btn-sm fw-semibold my-auto" data-bs-toggle="modal"
                      data-bs-target="#change_address" type="button">Change</button>
                  </div>
                </div>
              </div>
              <div class="modal fade" id="change_address" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h6 class="modal-title fs-5" id="exampleModalLabel"><span class="badge bg-secondary">Change
                          Address</span></h6>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-2">
                      {% for user_address in user_addresses %}
                      <div class="form-check border mb-2">
                        <div class="p-2">
                          <input class="form-check-input" type="radio" name="address" value="{{ user_address.id }}"
                            id="user_address{{ forloop.counter }}" {% if forloop.first %}checked{% endif %}>
                          <label class="form-check-label" for="address{{ forloop.counter }}">
                            <div>{{ user_address.gender }}. {{ user_address.first_name }} {{ user_address.last_name }}-
                              {{ user_address.mobile }}</div>
                            <div>{{ user_address.address }}</div>
                            <div>{{ user_address.place }} - {{ user_address.pincode }}</div>
                          </label>
                        </div>
                      </div>
                      {% endfor %}

                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-outline-info" value="Save" onclick="updateaddress()"
                        data-bs-dismiss="modal">Select </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow mt-4 custom-border">
              <div class="card-body">
                <h6 class="card-title"><span class="badge bg-secondary">Payment Method</span></h6>

                <form class="my-2">
                  <div class="border mb-2 p-2">
                    <div class="d-flex flex-row align-items-center">
                      <input type="radio" name="1radio" id="1r">
                      <label for="r1" id="cod-button1" class="ml-2 mb-0">Cash On Delivery</label>
                    </div>
                    <div class="d-flex flex-row align-items-center">
                      <input type="radio" name="2radio" id="2r">
                      <label for="r2" id="rzp-button1" class="ml-2 mb-0">Online Payment</label>
                    </div>
                  </div>
                </form>
              </div>
            </div>

            <div class="card p-3 d-flex justify-content-around mt-4 d-md-block shadow custom-border">
              <a href="{% url 'cart' %}" type="button"  class="btn btn-outline-light text-primary btn-sm border border-3 border-primary" data-mdb-ripple-init>Go Back To Cart</a>
              <a href=" " type="button" class="btn btn-outline-light btn-sm float-end text-success me-3 border border-3 border-success">Confirm Order</a>
            </div>
            <!-- Checkout -->
          </div>
      {% comment %} ======SECTION 2 ======== {% endcomment %}
          <div class=" col-lg-6 ms-3  custom-border">
              <h6 class="my-2"><span class="badge bg-secondary">Summary</span></h6>
              <div class="d-flex justify-content-between">
                <p class="mb-2">Total Price:</p>
                <p class="mb-2">₹{{cart.total_selling_price}}</p>
              </div>
              <div class="d-flex justify-content-between">
                <p class="mb-2">Coupon Discount:</p>
                <p class="mb-2 text-danger">- ₹ {{coupon_discount}} </p>
              </div>
              <div class="d-flex justify-content-between">
                <p class="mb-2">Delivery Charge:</p>
                <p class="mb-2 text-success">FREE</p>
              </div>
              <hr />
              <div class="d-flex justify-content-between mb-2 fw-bold">
                <p class="mb-2">Final Price:</p>
                <p class="mb-2 ">₹{{final_price}}</p>
              </div>
              <!-- coupons -->

              <div class="card">
                <div class="card-body">
                  <div class="input-group mt-3 mb-4">
                    <input type="text" class="form-control border" id="couponCodeInput" name="coupon_code" value=""
                      placeholder="Coupon code" />
                    <button class="btn btn-light text-success border" onclick="apply_coupon()">Apply</button>
                    <button class="btn btn-light text-danger border" onclick="clear_coupon()"><img width="25" height="25" src="https://img.icons8.com/hieroglyphs/32/FA5252/experimental-trash-hieroglyphs.png" alt="experimental-trash-hieroglyphs"/></button>                  
                  </div>

                  <div class="p-2" style="height: 150px; overflow-y: auto;">
                    <div class="coupon-container">
                      {% if coupons %}
                          {% for coupon in coupons %}
                          <div class="form-check border mb-2">
                            <div class="p-2">
                              <input class="form-check-input coupon-radio" type="radio" name="coupon"
                                value="{{ coupon.id }}" id="coupon{{ forloop.counter }}"
                                data-coupon-code="{{ coupon.coupon_code }}">
                              <label class="form-check-label" for="coupon{{ forloop.counter }}">
                                <div>
                                  {{ coupon.coupon_code }}
                                </div>
                                <div>
                                  ₹{{ coupon.discount_amount }}   {{ coupon.description }} ₹{{ coupon.minimum_amount }}
                                </div>
                              </label>
                            </div>
                          </div>
                          {% endfor %}
                      {% else %}
                          <p class="text-center" style="font-size: 0.80em;">No coupons available for the current total price.&#128546; <br> Add more products to unlock Coupons.&#128526;</p>
                      {% endif %}
                    </div>
                  </div>

                </div>
              </div>

              <!-- coupons -->
              <h5 class="ms-3 my-3"><span class="badge bg-secondary ">Items in cart</span></h5>
              <div class="card" style="max-height: 300px; overflow-y: auto;">
                <div class="border shadow">
              {% for item in cart_items %}
              <div class="card m-1 shadow ">
                <div class="card-body">
                  <div class="d-flex justify-content-center">
                    <div class="me-5 p-2  border">
                      <img src="{{ item.product_variant.cover_image.url }}" style="height: 150px; width: 150px;"
                        class="img-sm rounded border-0" />
                    </div>
                    <div class="">
                      <h6 class="fw-bolder">{{ item.product_variant.product.name }}</h6>
                      <div class="d-flex align-items-center">
                        <div>
                          <span class="border border-secondary rounded-3 fw-lighter p-1 me-1">Color : 
                            {{ item.product_variant.color_name }}</span>
                        </div>
                        <div class="ms-auto">
                          <a href="{% url 'remove_from_cart' pslug=item.product_variant.product.slug vslug=item.product_variant.slug %}"
                            role="button" type="button" class="btn btn-outline-danger ms-5" data-mdb-toggle="tooltip"
                            title="Remove item">
                            <i class="fas fa-trash"></i>
                          </a>
                        </div>
                      </div>
                      <hr class="pb-1">

                      <div class="d-flex  align-items-center">
                        <div class="fw-light border border-dark rounded-3 me-5 px-1">
                          Count : {{ item.count }}
                        </div>
                        <div class="text-dark border border-dark rounded-3 px-1">
                          ₹{{ item.total_selling_price }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>


            </div>
          </div>
        </div>
      <!-- </form> -->
    </div>

    <div class="modal fade" id="add_address" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable hiddenscrollbar">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title fs-5" id="exampleModalLabel"><span class="badge bg-secondary"> Add New Address</span>
            </h6>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="addressform" action="{% url 'add_address' %}" method="post">
              {% csrf_token %}
              <label for="address_type">Address Type</label>
              <select name="address_type" id="address_type" class="form-select mb-2">
                <option value="Home" selected>Home</option>
                <option value="Office">Office</option>
              </select>

              <label for="name">First Name</label>
              <input type="text" name="first_name" id="first_name" class="form-control mb-2" required>

              <label for="name">Last Name</label>
              <input type="text" name="last_name" id="last_name" class="form-control mb-2" required>

              <label for="gender">Gender</label>
              <select name="gender" id="gender" class="form-select mb-2">
                <option value="Mr" selected>Male</option>
                <option value="Mrs">Female</option>
              </select>

              <label for="mobile">Mobile</label>
              <input type="text" name="mobile" id="mobile" class="form-control mb-2" required>

              <label for="email">Email</label>
              <input type="email" name="email" id="email" class="form-control mb-2" required>

              <label for="address">Address</label>
              <textarea name="address" id="address" class="form-control mb-2" rows="3"></textarea>

              <label for="place">Place</label>
              <input type="text" name="place" id="place" class="form-control mb-2" required>

              <label for="landmark">Land Mark</label>
              <input type="text" name="landmark" id="landmark" class="form-control mb-2" required>

              <label for="addpincode">Pincode</label>
              <input type="text" name="pincode" id="addpincode" class="form-control mb-2"
                onkeyup="fetchPincodeData(this,'addpinhelp','addpostoffice','adddistrict','addstate')"
                aria-describedby="addpinhelp" required>
              <div id="addpinhelp" class="form-text text-danger"></div>

              <label for="postoffice">Post Office</label>
              <select class="form-select" name="post" id="addpostoffice"></select>

              <label for="district">District:</label>
              <input type="text" class="form-control mb-2" name="district" id="adddistrict" readonly>

              <label for="state">State:</label>
              <input type="text" class="form-control mb-2" name="state" id="addstate" readonly>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <input type="submit" onclick="saveaddress()" class="btn btn-primary" value="Save">
          </div>
        </div>
      </div>
    </div>

  </section>

  <!-- Footer -->
  <footer class="text-center text-lg-start text-muted  mt-3" style="background-color: #78BB7B">
    <!-- Section: Links  -->
    <section class="shadow">
      <div class="container text-center text-md-start pt-4 pb-4">
        <!-- Grid row -->
        <div class="row mt-3">
          <!-- Grid column -->
          <div class="col-12 col-lg-6 col-sm-12 mb-2">
            <!-- Content -->
            <a href="{% url 'home' %}" target="_blank" class="text-white h2">
              DAZZLE
            </a>
            <p class="mt-1 text-white">
              © 2023 Dazzle_Umbrella
            </p>
          </div>
          <!-- Grid column -->
        </div>
        <!-- Grid row -->
      </div>
    </section>
    <!-- Section: Links  -->

    <div class=""style="background-color: rgba(0, 0, 0, 0.1)">
      <div class="container">
        <div class="d-flex justify-content-between py-4 border-top">

          <div>
            <i class="fab fa-lg fa-cc-visa text-white"></i>
            <i class="fab fa-lg fa-cc-amex text-white"></i>
            <i class="fab fa-lg fa-cc-mastercard text-white"></i>
            <i class="fab fa-lg fa-cc-paypal text-white"></i>
          </div>
        </div>
      </div>
    </div>

    </div>
    

    <script>
      const couponRadios = document.querySelectorAll('.coupon-radio');
      let selectedRadioValue = localStorage.getItem('selectedRadioValue');
      let couponCodeInputValue = localStorage.getItem('couponCodeInputValue');
    
      couponRadios.forEach(radio => {
        radio.addEventListener('click', function() {
          couponRadios.forEach(radio => {
            radio.removeAttribute('checked');
          });
          this.setAttribute('checked', 'checked');
          const selectedCouponCode = this.parentElement.querySelector('.form-check-label div:first-child').innerText.trim();
          var coupon_id = this.value;
          document.getElementById('couponCodeInput').value = selectedCouponCode;
    
          // Store selected radio value in localStorage
          localStorage.setItem('selectedRadioValue', this.value);
          localStorage.setItem('couponCodeInputValue', selectedCouponCode);
        });
      });
    
      function apply_coupon(){
        const checkedRadio = document.querySelector('.coupon-radio:checked');
        let currentUrl = new URL(window.location.href);
        let urlparams = new URLSearchParams(currentUrl.search);
        urlparams.set('coupon', checkedRadio.value);
        currentUrl.search = urlparams.toString();
        window.location.href = currentUrl.toString();
      }
    
      // Retrieve stored values from localStorage on page load after button click
      document.addEventListener("DOMContentLoaded", function () {
        const selectedRadio = document.querySelector(`.coupon-radio[value="${selectedRadioValue}"]`);
        if (selectedRadio) {
          selectedRadio.setAttribute('checked', 'checked');
          document.getElementById('couponCodeInput').value = couponCodeInputValue;
        }
      });

      function clear_coupon() {
        fetch('{% url 'clear_coupon' %}', { method: 'POST' })
          .then(response => {
            if (response.redirected) {
              // Redirect to the checkout page or another desired page
              window.location.href = response.url;
            }
          })
          .catch(error => {
            console.error('Error clearing coupon:', error);
          });
          
        // Clear local storage and input field
        localStorage.removeItem('selectedRadioValue');
        localStorage.removeItem('couponCodeInputValue');
        document.getElementById('couponCodeInput').value = '';
        const checkedRadio = document.querySelector('.coupon-radio:checked');
        if (checkedRadio) {
          checkedRadio.checked = false;
        }
      }

    </script>

    <script>
      function saveorder() {
        orderform = document.getElementById('orderform')
        orderform.submit()
      }
      function saveaddress() {
        addressform = document.getElementById('addressform')
        addressform.submit()
      }
      function setcoupon(code, discount) {
        const couponcodeinput = document.getElementById('couponcodeinput')
        couponcodeinput.value = code
        changeinput();
      }
      function changeinput() {
        let coupon = document.getElementById("couponcodeinput").value;
        let coupondivs = document.querySelectorAll('[name="coupondiv"]')
        let savings = document.getElementById('savings')
        let coupon_submit = document.getElementById('coupon_submit')
        let flag = false
        for (let i = 0; i < coupondivs.length; i++) {
          let coupondetails = coupondivs[i].querySelector('[name="coupondetails"]');
          let expirey = coupondivs[i].querySelector('[name="expirey"]');
          let button = coupondivs[i].querySelector('[type="button"]');
          if (coupondivs[i].id == `coupondiv${coupon}`) {
            coupondivs[i].classList.add('bg-primary')
            coupondetails.classList.add("text-light")
            expirey.classList.add("text-light")
            button.classList.add("text-light")
            discount = coupondetails.getAttribute('discount')
            savings.textContent = `₹ ${discount}`
            coupon_submit.href = coupon_submit.href.replace('None', coupon)
            flag = true
          }
          else {
            coupondivs[i].classList.remove('bg-primary')
            coupondetails.classList.remove("text-light")
            expirey.classList.remove("text-light")
            button.classList.remove("text-light")
          }
        }
        if (flag == false) {
          savings.textContent = '₹ 0'
          coupon_submit.href = coupon_submit.href.replace(coupon, 'None')
        }
      }
      function fetchPincodeData(pincodeInput, helptext, postoffice, district, state) {
        const dropdown = document.getElementById(postoffice);
        const pincode = pincodeInput.value;
        dropdown.innerHTML = '';
        if (pincode.length !== 6) {
          document.getElementById(helptext).textContent = 'PIN code must be 6 characters long.';
          pincodeInput.classList.add('is-invalid');
          pincodeInput.classList.remove('is-valid');
          return;
        }
        else {
          document.getElementById(helptext).textContent = '';
          pincodeInput.classList.remove('is-invalid');
          pincodeInput.classList.add('is-valid');
        }
        const apiUrl = `https://api.postalpincode.in/pincode/${pincode}`;
        fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            if (data && data[0] && data[0].Status === 'Success') {
              const postofficeData = data[0].PostOffice.map(item => item.Name);
              postofficeData.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.text = name;
                dropdown.appendChild(option);
              });
              document.getElementById(district).value = data[0].PostOffice[0].District;
              document.getElementById(state).value = data[0].PostOffice[0].State;
            } else {
              document.getElementById(helptext).textContent = 'Invalid PIN Code';
              pincodeInput.classList.add('is-invalid');
            }
          })
          .catch(error => {
            document.getElementById(helptext).textContent = 'An error occurred while fetching data.';
          });
      }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const initiallyCheckedRadio = document.querySelector("input[name='address']:checked");
        if (initiallyCheckedRadio) {
          const radiolabel = initiallyCheckedRadio.parentElement.querySelector("label");
          const selectedaddress = document.getElementById('selectedaddress');
          selectedaddress.innerHTML = radiolabel.innerHTML;
        }
      });
      function updateaddress() {
        const selectedradio = document.querySelector("input[name='address']:checked");
        const radiolabrl = selectedradio.parentElement.querySelector("label");
        const selectedaddress = document.getElementById('selectedaddress')
        selectedaddress.innerHTML = radiolabrl.innerHTML;
      }
      const codRadio = document.getElementById("cod");
      const onlineRadio = document.getElementById("online");
      const rzpButton = document.getElementById("rzp-button1");
      const codButton = document.getElementById("cod-button1");

      codRadio.addEventListener("change", () => {
        rzpButton.classList.add("d-none");
        codButton.classList.remove("d-none");
      });

      onlineRadio.addEventListener("change", () => {
        codButton.classList.add("d-none");
        rzpButton.classList.remove("d-none");
      });
    </script>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="/docs/4.3/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="https://getbootstrap.com/docs/4.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o"
      crossorigin="anonymous"></script>
    <script src="https://getbootstrap.com/docs/4.3/examples/checkout/form-validation.js"></script>
</body>

</html>